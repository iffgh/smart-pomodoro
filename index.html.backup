<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🍅 Умный Pomodoro Таймер</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/achievements.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>🍅 Умный Pomodoro</h1>
            <p class="subtitle">Сфокусируйтесь и восстановитесь с умными практиками</p>
        </header>
        
        <div class="settings">
            <h3 class="section-title">⚙️ Настройки времени</h3>
            <div class="time-inputs">
                <div class="time-input">
                    <label>🕐 Работа (мин)</label>
                    <input type="number" id="workTime" min="1" max="120" value="25">
                </div>
                <div class="time-input">
                    <label>🔄 Отдых (сек)</label>
                    <input type="number" id="breakTime" min="1" max="600" value="30">
                </div>
            </div>
            <button class="settings-btn" onclick="pomodoro.applySettings()">💾 Применить настройки</button>
        </div>
        
        <div id="timerSection" class="timer-section work-active">
            <div id="sessionInfo">💼 Сессия 1 • Сфокусируйтесь!</div>
            <div id="practiceInfo"></div>
            <div class="timer-display" id="timerDisplay">25:00</div>
            <div class="progress-container">
                <div id="progress" class="progress-fill progress-work" style="width: 100%"></div>
            </div>
            
            <div id="currentStepInfo" class="current-step-info"></div>
            
            <div class="mini-stats">
                <div class="mini-stat">
                    <div class="mini-stat-value" id="miniSessionsCompleted">0</div>
                    <div class="mini-stat-label">💼 Сессий</div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-value" id="miniTotalTime">0:00</div>
                    <div class="mini-stat-label">⏱️ Время</div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-value" id="miniTechniquesUsed">0</div>
                    <div class="mini-stat-label">🌿 Практик</div>
                </div>
            </div>
            
            <div id="stepInstruction" class="step-instruction">Нажмите "Старт" для начала работы</div>
            <div id="nextStepPreview" class="next-step-preview" style="display: none;"></div>
            
            <div class="controls">
                <button id="mainButton" class="primary-btn" onclick="pomodoro.toggleTimer()"><span>▶</span> Старт</button>
                <button class="secondary-btn" onclick="pomodoro.resetTimer()"><span>↺</span> Сброс</button>
            </div>
        </div>
        
        <div class="techniques-section">
            <h3 class="section-title">🌿 Практики восстановления</h3>
            <div id="categoryDescription" class="category-description">
                <strong>🌬️ Дыхательные практики:</strong> Техники управления дыханием для снятия стресса, улучшения концентрации и восстановления энергетического баланса.
            </div>
            <div class="auto-practice-info">После завершения работы автоматически начнется практика восстановления</div>
            <div class="techniques-categories">
                <div class="category-btn active" onclick="pomodoro.showCategory('breathing')">🌬️ Дыхание</div>
                <div class="category-btn" onclick="pomodoro.showCategory('physical')">💪 Физические</div>
                <div class="category-btn" onclick="pomodoro.showCategory('vision')">👀 Зрение</div>
                <div class="category-btn" onclick="pomodoro.showCategory('cognitive')">🧠 Когнитивные</div>
                <div class="category-btn" onclick="pomodoro.showCategory('energy')">⚡ Энергия</div>
            </div>
            <div class="techniques-grid" id="techniquesGrid"></div>
        </div>
        
        <div id="practiceSteps" class="practice-steps">
            <h3>📋 Шаги выполнения</h3>
            <ul id="stepList" class="step-list"></ul>
        </div>

        <div class="sessions-history">
            <div class="history-header" onclick="pomodoro.toggleHistory()">
                <h3 class="section-title">📊 История сессий</h3>
                <div class="history-toggle">▼</div>
            </div>
            <div class="history-content" id="historyContent">
                <div class="auto-practice-info">Ваши завершенные рабочие периоды и практики восстановления</div>
                <ul id="historyList" class="history-list"></ul>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">
        <span id="notificationIcon">🔔</span>
        <span id="notificationText">Уведомление</span>
    </div>

    <script src="js/custom.js"></script>
<script src="js/achievements.js"></script>
<script src="js/statistics.js"></script>
<script src="js/practices.js"></script>
<script src="js/notifications.js"></script>
<script src="js/settings-manager.js"></script>
<script src="js/floating-settings.js"></script>
<script src="js/timer.js"></script>
<script src="js/main.js"></script>

        <!-- 🎨 ПЛАВАЮЩАЯ ШЕСТЕРЕНКА -->
        <div class="floating-settings">
            <button id="settingsToggle" class="settings-toggle-btn" onclick="toggleSettings()">⚙️</button>
            
            <div id="settingsPanel" class="settings-panel">
                <div class="settings-header">
                    <h3>🎨 Настройки</h3>
                    <button class="close-btn" onclick="toggleSettings()">×</button>
                </div>
                
                <div class="settings-section">
                    <h4>🔊 Звуки</h4>
                    <div class="setting-item">
                        <label class="switch">
                            <input type="checkbox" id="soundEnabled" checked>
                            <span class="slider"></span>
                        </label>
                        <span>Включить звуки</span>
                    </div>
                    <div class="setting-item">
                        <label>Громкость:</label>
                        <input type="range" id="soundVolume" min="1" max="10" value="5">
                        <span id="volumeValue">50%</span>
                    </div>
                    <button onclick="testSound()">🔊 Тест звука</button>
                </div>
                
                <div class="settings-section">
                    <h4>🎭 Тема</h4>
                    <div class="themes-grid">
                        <div class="theme-option" onclick="changeTheme('default')">
                            <div class="theme-preview default-theme"></div>
                            <span>По умолчанию</span>
                        </div>
                        <div class="theme-option" onclick="changeTheme('dark')">
                            <div class="theme-preview dark-theme"></div>
                            <span>Темная</span>
                        </div>
                        <div class="theme-option" onclick="changeTheme('nature')">
                            <div class="theme-preview nature-theme"></div>
                            <span>Природа</span>
                        </div>
                    </div>
                </div>
                
                <div class="settings-actions">
                    <button onclick="saveSettings()">💾 Сохранить</button>
                    <button onclick="resetSettings()">🔄 Сбросить</button>
                </div>
            </div>
        </div>
        <script>
    // 🎨 УЛУЧШЕННЫЙ СКРИПТ ДЛЯ ШЕСТЕРЕНКИ
    console.log("🎨 Улучшенный скрипт настроек загружен!");
    
    let currentTheme = 'default';
    
    
            panel.style.display = 'none';
            toggleBtn.style.transform = 'rotate(0deg)';
        } else {
            panel.style.display = 'block';
            toggleBtn.style.transform = 'rotate(90deg)';
        }
    }
    
    function changeTheme(theme) {
        console.log("🎨 Меняем тему на:", theme);
        currentTheme = theme;
        
        // Убираем все классы тем
        document.body.className = '';
        // Добавляем класс текущей темы
        document.body.classList.add(theme + '-theme');
        
        // Обновляем активную тему в интерфейсе
        document.querySelectorAll('.theme-option').forEach(option => {
            option.classList.remove('active');
        })
        document.querySelector(`[data-theme="${theme}"]`).classList.add('active');
        
        // Сохраняем тему
        localStorage.setItem('currentTheme', theme);
    }
    
    function testSound() {
        console.log("🔊 Тестируем звук");
        if (window.notificationManager) {
            if (window.notificationManager.soundActivated) {
                window.notificationManager.playWorkEndSound();
            } else {
                alert("🔇 Сначала кликните по странице для активации звуков!");
            }
        }
    }
    
    function saveSettings() {
        console.log("💾 Сохраняем настройки");
        const soundEnabled = document.getElementById('soundEnabled').checked;
        
        // Важно: обновляем настройки звука
        if (window.notificationManager) {
            window.notificationManager.soundEnabled = soundEnabled;
            console.log("🔊 Настройки звука обновлены:", soundEnabled);
        }
        
        localStorage.setItem('soundEnabled', soundEnabled);
        localStorage.setItem('soundVolume', document.getElementById('soundVolume').value);
        localStorage.setItem('currentTheme', currentTheme);
        
        toggleSettings();
        
        // Показываем уведомление
        if (window.notificationManager && soundEnabled) {
            // Создаем простое уведомление
            try {
                new Notification("Настройки сохранены", {
                    body: "Изменения применены успешно!",
                    icon: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>✅</text></svg>"
                })
            } catch (e) {
                console.log("Уведомления не поддерживаются");
            }
        }
        
        alert("✅ Настройки сохранены!");
    }
    
    function resetSettings() {
        console.log("🔄 Сбрасываем настройки");
        if (confirm("Вы уверены, что хотите сбросить все настройки к默认ным?")) {
            document.getElementById('soundEnabled').checked = true;
            document.getElementById('soundVolume').value = 5;
            document.getElementById('volumeValue').textContent = '50%';
            
            changeTheme('default');
            
            localStorage.removeItem('soundEnabled');
            localStorage.removeItem('soundVolume');
            localStorage.removeItem('currentTheme');
            
            // Принудительно обновляем настройки звука
            if (window.notificationManager) {
                window.notificationManager.soundEnabled = true;
            }
            
            alert("✅ Настройки сброшены к默认ным!");
        }
    }
    
    // 📥 Инициализация после загрузки
    document.addEventListener('DOMContentLoaded', function() {
        console.log("🔧 Инициализация улучшенных настроек...");
        
        // Загружаем сохраненные настройки
        const savedSound = localStorage.getItem('soundEnabled');
        const savedVolume = localStorage.getItem('soundVolume');
        const savedTheme = localStorage.getItem('currentTheme');
        
        if (savedSound !== null) {
            document.getElementById('soundEnabled').checked = savedSound === 'true';
            // Применяем настройки звука сразу
            if (window.notificationManager) {
                window.notificationManager.soundEnabled = (savedSound === 'true');
            }
        }
        
        if (savedVolume !== null) {
            document.getElementById('soundVolume').value = savedVolume;
            document.getElementById('volumeValue').textContent = (savedVolume * 10) + '%';
        }
        
        if (savedTheme) {
            changeTheme(savedTheme);
        }
        
        // Обновление громкости
        document.getElementById('soundVolume').addEventListener('input', function(e) {
            document.getElementById('volumeValue').textContent = (e.target.value * 10) + '%';
        })
        
        // Обработчик для чекбокса звука
        document.getElementById('soundEnabled').addEventListener('change', function(e) {
            console.log("🔊 Звук переключен на:", e.target.checked);
            if (window.notificationManager) {
                window.notificationManager.soundEnabled = e.target.checked;
            }
        })
        
        console.log("✅ Улучшенные настройки инициализированы");
    })
    </script>
    <!-- Патчи для исправления ошибок -->
    <script src="js/sound-patch.js"></script>
    <script src="js/diagnostic.js"></script>
    <!-- Патчи для исправления ошибок -->
    <script src="js/sound-patch.js"></script>
    <script src="js/diagnostic.js"></script>
    <!-- Патчи для исправления ошибок -->
    <script src="js/sound-patch.js"></script>
    <script src="js/diagnostic.js"></script>
</body>
</html>
















